function AnalyticsTracker() {

  this.initialize = function() {
    // console.log('AnalyticsTracker initializing...');

    var _this = this;
    this.asyncList = [];

    mixpanel.init("<%= Rails.application.secrets.mixpanel[:token] %>", {
      cross_subdomain_cookie: <%= !Rails.env.staging? %>,
      loaded: function() {
        for (var i = 0; i < _this.asyncList.length; i++) {
          func = _this.asyncList[i];
          func()
        }
      }
    })

  }


  this.delayed = function(callback){
    if (!mixpanel.__loaded){
      this.asyncList.push(callback)
    } else {
      callback()
    }
  }

  this.track = function(event, args) {
    var _this = this;
    this.delayed(function(){
      // args = $.extend(args, {'logged_in' : _this.userLoggedIn()});
      return mixpanel.track(event, args);
    });
  };


}


var tracker = new AnalyticsTracker();
tracker.initialize();

window.tracker = tracker;

